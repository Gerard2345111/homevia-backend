<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homevia ‚Äî Smart Housing</title>

<!-- Google Maps -->
<script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDz1PwJ9hLUBKoaVtT-OJnBWZFTAxXnZVc&callback=initMap"></script>

<!-- Paystack -->
<script src="https://js.paystack.co/v1/inline.js"></script>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<style>
:root{
  --primary:#0f172a;
  --accent:#22c55e;
  --danger:#ef4444;
  --bg:#f8fafc;
  --card:#ffffff;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);color:#111}
header{
  background:var(--primary);
  color:#fff;
  padding:1rem;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
nav button{
  background:none;border:none;color:#fff;
  margin-left:1rem;font-weight:600;cursor:pointer
}
main{max-width:1200px;margin:auto;padding:1rem}
.card{
  background:var(--card);
  border-radius:16px;
  padding:1rem;
  margin-bottom:1rem;
  box-shadow:0 10px 30px rgba(0,0,0,.06)
}
.grid{display:grid;gap:1rem}
@media(min-width:900px){
  .grid{grid-template-columns:2fr 1fr}
}
input,select,button{
  width:100%;padding:12px;margin-top:.5rem;
  border-radius:10px;border:1px solid #ddd
}
button{background:var(--accent);color:#fff;border:none;font-weight:600}
.hidden{display:none}
#map{height:400px;border-radius:16px}
.listing{border-bottom:1px solid #eee;padding:.8rem 0}
.badge{background:var(--accent);color:#fff;padding:4px 8px;border-radius:999px;font-size:12px}
.admin-badge{background:var(--primary)}
.danger{background:var(--danger)}
</style>
</head>

<body>

<header>
  <h2>üè† Homevia</h2>
  <nav>
    <button onclick="show('home')">Home</button>
    <button onclick="show('pricing')">Pricing</button>
    <button onclick="show('post')">Post</button>
    <button onclick="show('admin')">Admin</button>
    <button onclick="show('login')">Login</button>
  </nav>
</header>

<main>

<!-- LOGIN -->
<div id="login" class="card hidden">
  <h3>Login</h3>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Continue</button>
</div>

<!-- HOME -->
<div id="home">
  <div class="grid">
    <div class="card">
      <h3>üìç Homes Near You</h3>
      <div id="map"></div>
    </div>

    <div class="card">
      <h3>üîç Filters</h3>
      <select id="type">
        <option value="">Any</option>
        <option value="rent">Rent</option>
        <option value="sale">Sale</option>
      </select>
      <input id="maxPrice" placeholder="Max price">
      <button onclick="loadListings()">Apply</button>
    </div>
  </div>

  <div class="card">
    <h3>üèò Listings</h3>
    <div id="listings"></div>
  </div>
</div>

<!-- POST -->
<div id="post" class="card hidden">
  <h3>Post Property</h3>
  <input id="title" placeholder="Title">
  <input id="price" placeholder="Price">
  <input id="location" placeholder="Location">
  <select id="ptype">
    <option value="rent">Rent</option>
    <option value="sale">Sale</option>
  </select>
  <button onclick="postListing()">Submit</button>
</div>

<!-- PRICING -->
<div id="pricing" class="card hidden">
  <h3>üí≥ Pricing</h3>
  <p><b>Free:</b> 1 active listing</p>
  <p><b>Premium:</b> ‚Ç¶3,000 / listing</p>
  <p><b>Agent Plan:</b> ‚Ç¶10,000 / month</p>
</div>

<!-- ADMIN -->
<div id="admin" class="hidden">

  <div class="card">
    <h3>üìä Analytics</h3>
    <canvas id="chart"></canvas>
  </div>

  <div class="card">
    <h3>üö® Fraud Review</h3>
    <div id="fraud">
      <p>Listing #23 ‚Äî Risk 82% <span class="badge danger">FLAGGED</span></p>
      <button class="danger">Reject</button>
      <button>Approve</button>
    </div>
  </div>

</div>

</main>

<script>
const API = "https://homevia-backend.onrender.com/api";
let map, markers=[];

/* ROUTER */
function show(id){
  document.querySelectorAll('main > div').forEach(d=>d.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

/* LOGIN */
async function login(){
  const res = await fetch(`${API}/auth/login/`,{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({email:email.value,password:password.value})
  });
  const data = await res.json();
  localStorage.setItem("token",data.token);
  alert("Logged in");
  show('home');
}

/* MAP */
function initMap(){
  navigator.geolocation.getCurrentPosition(pos=>{
    map=new google.maps.Map(document.getElementById("map"),{
      center:{lat:pos.coords.latitude,lng:pos.coords.longitude},
      zoom:13
    });
  });
}

/* LISTINGS */
async function loadListings(){
  listings.innerHTML="Loading...";
  const res = await fetch(`${API}/listings/`);
  const data = await res.json();
  listings.innerHTML="";
  markers.forEach(m=>m.setMap(null)); markers=[];
  data.forEach(l=>{
    listings.innerHTML+=`
      <div class="listing">
        <b>${l.title}</b>
        ${l.premium?'<span class="badge">Premium</span>':''}
        <p>${l.location}</p>
        <b>‚Ç¶${l.price}</b>
        ${!l.premium?`<button onclick="pay(${l.id})">Upgrade</button>`:''}
      </div>`;
    if(l.lat&&l.lng){
      markers.push(new google.maps.Marker({position:{lat:l.lat,lng:l.lng},map}));
    }
  });
}

/* POST */
async function postListing(){
  await fetch(`${API}/listings/`,{
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'Authorization':'Bearer '+localStorage.getItem("token")
    },
    body:JSON.stringify({
      title:title.value,price:price.value,
      location:location.value,type:ptype.value
    })
  });
  alert("Submitted");
  show('home');
}

/* PAYSTACK */
function pay(listingId){
  PaystackPop.setup({
    key:'YOUR_PAYSTACK_PUBLIC_KEY',
    email:'user@homevia.com',
    amount:300000,
    callback:r=>verify(r.reference,listingId)
  }).openIframe();
}
async function verify(ref,id){
  await fetch(`${API}/listings/verify-payment/`,{
    method:'POST',
    headers:{
      'Content-Type':'application/json',
      'Authorization':'Bearer '+localStorage.getItem("token")
    },
    body:JSON.stringify({reference:ref,listing_id:id})
  });
  loadListings();
}

/* ADMIN CHART */
new Chart(document.getElementById('chart'),{
  type:'line',
  data:{
    labels:['Mon','Tue','Wed','Thu','Fri'],
    datasets:[{label:'Listings',data:[4,7,10,12,18]}]
  }
});

loadListings();
</script>

</body>
</html>