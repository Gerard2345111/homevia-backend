<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Homevia ‚Äî Rentals & Housing</title>

<!-- Google Maps -->
<script defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDz1PwJ9hLUBKoaVtT-OJnBWZFTAxXnZVc&callback=initMap"></script>

<!-- Paystack -->
<script src="https://js.paystack.co/v1/inline.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#f8fafc}
header{background:#0f172a;color:#fff;padding:1rem}
.card{background:#fff;padding:1.5rem;border-radius:14px;margin-bottom:1rem;box-shadow:0 10px 30px rgba(0,0,0,.08)}
main{max-width:1100px;margin:auto;padding:1rem}
input,select,button{width:100%;padding:12px;margin-top:8px;border-radius:10px;border:1px solid #ddd}
button{background:#22c55e;color:#fff;border:none;font-weight:600}
.hidden{display:none}
#map{height:350px;border-radius:12px}
.listing{border-bottom:1px solid #eee;padding:10px 0}
.badge{background:#22c55e;color:#fff;padding:4px 8px;border-radius:999px;font-size:12px}
</style>
</head>

<body>

<header>
  <h2>üè† Homevia</h2>
</header>

<main>

<!-- SIGN UP (DEFAULT VIEW) -->
<div id="signupBox" class="card">
  <h3>Create Account</h3>
  <input id="name" placeholder="Full Name">
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="signup()">Sign Up</button>
  <p id="signupMsg"></p>
</div>

<!-- LOGIN (HIDDEN INITIALLY) -->
<div id="loginBox" class="card hidden">
  <h3>Login</h3>
  <input id="loginEmail" placeholder="Email">
  <input id="loginPassword" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="loginMsg"></p>
</div>

<!-- HOME -->
<div id="home" class="hidden">
  <div class="card">
    <h3>üìç Homes Near You</h3>
    <div id="map"></div>
  </div>

  <div class="card">
    <h3>üèò Listings</h3>
    <div id="listings"></div>
  </div>
</div>

<!-- POST -->
<div id="post" class="card hidden">
  <h3>Post Property</h3>
  <input id="title" placeholder="Title">
  <input id="price" placeholder="Price">
  <input id="location" placeholder="Location">
  <select id="ptype">
    <option value="rent">Rent</option>
    <option value="sale">Sale</option>
  </select>
  <button onclick="postListing()">Submit</button>
</div>

</main>

<script>
const API = "https://homevia-backend.onrender.com/api";
let map, markers=[];

/* ================= SIGN UP ================= */
async function signup(){
  signupMsg.textContent = "Creating account...";
  const res = await fetch(`${API}/auth/register`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      name:name.value,
      email:email.value,
      password:password.value
    })
  });

  const data = await res.json();
  if(!res.ok){
    signupMsg.textContent = data.message;
    return;
  }

  signupMsg.style.color="green";
  signupMsg.textContent = "Account created! Please login.";

  document.getElementById("signupBox").classList.add("hidden");
  document.getElementById("loginBox").classList.remove("hidden");
}

/* ================= LOGIN ================= */
async function login(){
  loginMsg.textContent="Logging in...";
  const res = await fetch(`${API}/auth/login`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      email:loginEmail.value,
      password:loginPassword.value
    })
  });

  const data = await res.json();
  if(!res.ok){
    loginMsg.textContent=data.message;
    return;
  }

  localStorage.token = data.token;
  document.getElementById("loginBox").classList.add("hidden");
  document.getElementById("home").classList.remove("hidden");
  loadListings();
}

/* ================= MAP ================= */
function initMap(){
  navigator.geolocation.getCurrentPosition(
    pos=>{
      map=new google.maps.Map(document.getElementById("map"),{
        center:{lat:pos.coords.latitude,lng:pos.coords.longitude},
        zoom:13
      });
    },
    ()=>{
      map=new google.maps.Map(document.getElementById("map"),{
        center:{lat:6.5244,lng:3.3792},
        zoom:12
      });
    }
  );
}

/* ================= LISTINGS ================= */
async function loadListings(){
  const res = await fetch(`${API}/listings`);
  const data = await res.json();
  listings.innerHTML="";
  markers.forEach(m=>m.setMap(null)); markers=[];

  data.forEach(l=>{
    listings.innerHTML+=`
      <div class="listing">
        <b>${l.title}</b>
        ${l.premium?'<span class="badge">Premium</span>':''}
        <p>${l.location}</p>
        <b>‚Ç¶${l.price}</b>
      </div>
    `;
  });
}

/* ================= POST ================= */
async function postListing(){
  await fetch(`${API}/listings`,{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":"Bearer "+localStorage.token
    },
    body:JSON.stringify({
      title:title.value,
      price:price.value,
      location:location.value,
      type:ptype.value
    })
  });
  alert("Posted");
  loadListings();
}
</script>

</body>
</html>